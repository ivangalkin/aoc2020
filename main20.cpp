#include <iostream>
#include <string_view>
#include <tuple>
#include <set>
#include <map>
#include <algorithm>

#include <regex>


using namespace std::string_view_literals;

static std::string input[] = {

};

static std::string input2[]= {

};

static std::string input3[] = {

};

std::map<uint64_t, std::vector<std::string>> tiles;

size_t grid_min = 0;
size_t grid_max = 12;


enum Sides {
    TOP = 0, RIGHT, LEFT, BOTTOM
};

size_t num_alternatives = 4 + 4;

using Tile = std::vector<std::string>;

void rotate(Tile& mat)
{
    size_t N = mat.size();
    // Consider all squares one by one
    for (int x = 0; x < N / 2; x++) {
        // Consider elements in group
        // of 4 in current square
        for (int y = x; y < N - x - 1; y++) {
            // Store current cell in
            // temp variable
            int temp = mat[x][y];

            // Move values from right to top
            mat[x][y] = mat[y][N - 1 - x];

            // Move values from bottom to right
            mat[y][N - 1 - x]
                    = mat[N - 1 - x][N - 1 - y];

            // Move values from left to bottom
            mat[N - 1 - x][N - 1 - y]
                    = mat[N - 1 - y][x];

            // Assign temp to left
            mat[N - 1 - y][x] = temp;
        }
    }
}

std::vector<std::string> rotate_pic(Tile tile, uint64_t alternative) {
    if (alternative>=4) {
        // flip horizontally
        for (auto& line: tile) {
            std::reverse(line.begin(), line.end());
        }
    }

    // clockwise rotation
    uint64_t rotation = (alternative % 4);
    for (int i = 0; i < rotation; i++) {
        rotate(tile);
    }
    return tile;
}

std::vector<std::string> cleanup(Tile tile) {
    tile.erase(tile.begin());
    tile.pop_back();

    for (auto& line: tile) {
        line = line.substr(1, 8);
    }
    return tile;
}

std::string get(Tile tile, Sides s, uint64_t alternative) {

    if (alternative>=4) {
      // flip horizontally
      for (auto& line: tile) {
          std::reverse(line.begin(), line.end());
      }
    }

    // clockwise rotation
    uint64_t rotation = (alternative % 4);
    for (int i = 0; i < rotation; i++) {
        rotate(tile);
    }

    if (s == TOP) {
        return tile[0];
    }
    if ( s == BOTTOM) {
        return tile[9];
    }

    std::string left;
    for (int i = 0; i < 10; i++) {
        left.append(1, tile[i][0]);
    }
    if ( s == LEFT) {
        return left;
    }

    std::string right;
    for (int i = 0; i < 10; i++) {
        right.append(1, tile[i][9]);
    }
    if (s == RIGHT) {
        return right;
    }

    __builtin_unreachable();
}


struct TileWithNumber {
    Tile* tile = nullptr;
    size_t alternative = 0;
    size_t nr = 0;
};

struct Grid  {
    std::vector<std::vector<TileWithNumber>> data;
    std::vector<uint64_t> remaining_tiles_nr;
};

static std::vector<std::string> monster {
        "                  # ",
        "#    ##    ##    ###",
        " #  #  #  #  #  #   ",
};


std::vector<std::string> merge(Grid g) {
    std::vector<std::string> res(8 * 12); // ( 10 - 2 ) * 12
    for (size_t grid_y = 0; grid_y < grid_max; grid_y++) {
        for (size_t grid_x = 0; grid_x < grid_max; grid_x++) {
            auto cleanup_tile = cleanup(rotate_pic(*(g.data[grid_y][grid_x].tile), g.data[grid_y][grid_x].alternative));
            for (size_t tile_row = 0; tile_row <8; tile_row++) {
                res[grid_y * 8 + tile_row].append(cleanup_tile[tile_row]);
            }
        }

    }
    return res;
}

bool is_monster_at(size_t x, size_t y, const std::vector<std::string>& pic) {
    for (size_t monster_y = 0; monster_y <3; monster_y++) {
        for (size_t monster_x = 0; monster_x < 20; monster_x++) {
            if (monster[monster_y][monster_x] == '#' && pic[y+monster_y][x + monster_x] != '#') {
                return false;
            }
        }
    }
    return true;
}

size_t search_monsters(const std::vector<std::string>& pic) {
    size_t count = 0;
    for (size_t y = 0; y <= pic.size()-3; y++) {
        for (size_t x = 0; x <= pic[0].size()-20; x++) {
            if (is_monster_at(x, y, pic)) {
                ++count;
            } else {
                continue;
            }
        }
    }
    return count;
}


size_t get_x(size_t tile) {
    return tile % grid_max;
}

size_t get_y(size_t tile) {
    return tile / grid_max;
}

bool add(const Grid& grid, size_t tile_nr, size_t position, size_t alternative) {
    auto x = get_x(position);
    auto y = get_y(position);

    auto& me = tiles.at(tile_nr);

    if (x > 0) {
        auto& t = grid.data.at(y).at(x-1);
        auto t_right = get(*(t.tile), RIGHT, t.alternative);
        auto my_left = get(me, LEFT, alternative);
        if (t_right != my_left) {
            return false;
        }
    }
    if (y > 0) {
        auto& t = grid.data.at(y-1).at(x);
        auto t_bottom = get(*(t.tile), BOTTOM, t.alternative);
        auto my_top = get(me, TOP, alternative);
        if (t_bottom != my_top) {
            return false;
        }
    }

    return true;
}

void fill_tiles() {

    tiles[2131] = {
            "###..#...#",
            "##..#.##.#",
            "..###...#.",
            "......#..#",
            "##.#.....#",
            "..#..#...#",
            "......#...",
            "......#...",
            ".........#",
            "#.##..#.##",
    };
    tiles[2441] = {
            "..#.#.....",
            "#.#.......",
            "..........",
            "...#.#....",
            "....###.#.",
            "#....#...#",
            "#.#...#...",
            "#...#.....",
            "#...#....#",
            ".##.#.#..#",
    };
    tiles[1571] = {
            "....#....#",
            "...#...##.",
            ".#.....#..",
            "....#..#..",
            "#....##.##",
            "###..#....",
            "....#.#.#.",
            "..#....#..",
            "#...###..#",
            "#.########",
    };
    tiles[2179] = {
            "#####..#.#",
            "##......##",
            "#.....#.#.",
            "#...#....#",
            ".....#.#..",
            "####.....#",
            ".#..#.#..#",
            "##..###...",
            "##.....##.",
            "..#.####.#",
    };
    tiles[1433] = {
            "#....#..##",
            "#.##...#..",
            ".........#",
            "#..#....#.",
            "#......#..",
            ".#.....###",
            "#......###",
            "#..#..#...",
            ".........#",
            ".#.#.#....",
    };
    tiles[1283] = {
            "...#.##...",
            "##.......#",
            "#..#.....#",
            ".####.##..",
            "..#..#.###",
            "#.....#...",
            ".##..##.##",
            "#........#",
            "..........",
            "#.##......",
    };
    tiles[1667] = {
            ".#####.#.#",
            "...#.....#",
            "##...#...#",
            "#..#....#.",
            ".........#",
            "...##..#.#",
            "...#..#..#",
            "#.#.....##",
            "#.........",
            "#..#..####",
    };
    tiles[1657] = {
            "##.#.#..##",
            "#.....#.#.",
            "#........#",
            "....#....#",
            "......#...",
            "......#..#",
            "#..#.....#",
            ".##.......",
            "#...#.##.#",
            ".#.##..##.",
    };
    tiles[1259] = {
            "..#.....##",
            "##.......#",
            ".......#.#",
            "#..#.....#",
            ".#..#.....",
            "#.#..##..#",
            ".##.....##",
            "##.......#",
            "##...#....",
            "########..",
    };
    tiles[2161] = {
            ".#.#.###.#",
            "....##.#..",
            "..##.#...#",
            "....#.#..#",
            "#.........",
            ".#.#......",
            "#.#.......",
            "#.##.....#",
            "##.##....#",
            ".#######.#",
    };
    tiles[3793] = {
            ".##.##..##",
            "#.........",
            "........#.",
            ".#.......#",
            ".......#.#",
            ".#.......#",
            "#.......##",
            "....#....#",
            "#.#.......",
            "####..##.#",
    };
    tiles[2953] = {
            "....####..",
            "#..#...##.",
            ".........#",
            ".#...#..##",
            "..#..#.#..",
            "..........",
            "#.........",
            "....##.#..",
            "##..###.#.",
            "...####.##",
    };
    tiles[1979] = {
            ".####.###.",
            ".....#.##.",
            "##..#.#..#",
            ".##..#.###",
            "#..#..#..#",
            ".#...####.",
            "#....##..#",
            "###.#...##",
            ".#...##..#",
            ".##.#..##.",
    };
    tiles[3061] = {
            "...####..#",
            "#...#....#",
            "..#...#...",
            "#.##......",
            ".........#",
            "#.#.......",
            "#........#",
            ".....#....",
            "#.#......#",
            ".##....#..",
    };
    tiles[2731] = {
            "..#...##.#",
            "#......#.#",
            ".....##...",
            ".....##..#",
            "#.##.#..#.",
            "##....##..",
            "..........",
            "#........#",
            ".........#",
            "##..#...#.",
    };
    tiles[1439] = {
            "..###.####",
            "....##...#",
            "........##",
            ".........#",
            "#.......##",
            "..##...#.#",
            "....#.#..#",
            "......#...",
            "#.##.#.#.#",
            "##.##...##",
    };
    tiles[3347] = {
            "..#.##.###",
            "...#...#.#",
            "#.#.#...#.",
            "#..#...###",
            ".##....#..",
            "##........",
            "##.#..#..#",
            "..#....#..",
            "..##..#.#.",
            "..#######.",
    };
    tiles[1559] = {
            "###.#.####",
            "#.......#.",
            "#.......#.",
            "..#.##..#.",
            "..#.....#.",
            "#...#..#.#",
            "#..#....##",
            "#.##......",
            "#.#..#...#",
            ".#..#####.",
    };
    tiles[3559] = {
            "...##.##..",
            "#........#",
            "..##......",
            "#...#.....",
            "##.#..##..",
            "#.........",
            "#.#....#.#",
            "#.........",
            "....#....#",
            "#...#.###.",
    };
    tiles[3109] = {
            ".##..#....",
            "#........#",
            "#.....##.#",
            ".....##.#.",
            "#.#......#",
            "#.##......",
            "#......#.#",
            "#....##..#",
            ".#.##..###",
            ".#.....#..",
    };
    tiles[3701] = {
            "#..#..#...",
            "..#..#...#",
            "#.........",
            "#.........",
            ".....#.###",
            ".....#....",
            ".#..#...##",
            "#.........",
            "#.#.#....#",
            "#..###..##",
    };
    tiles[1597] = {
            ".##.#.#.#.",
            "..#.#.#..#",
            "#.......##",
            "...#.....#",
            "#........#",
            ".#.......#",
            "..#.#....#",
            "..........",
            "#.#.##...#",
            ".....####.",
    };
    tiles[1231] = {
            ".#####....",
            "#....##...",
            "##..#..#.#",
            "...#......",
            "#.........",
            "#..#......",
            "#.#...#..#",
            "..#..#..##",
            "#..##..#..",
            "##.###....",
    };
    tiles[3389] = {
            ".###....#.",
            "#.......#.",
            "#....#....",
            "#...#....#",
            "..#.##...#",
            ".....##.##",
            "..........",
            "###...#..#",
            "#..#.#.#..",
            "#####..##.",
    };
    tiles[3461] = {
            "....#.###.",
            "..........",
            "..........",
            "...#...#.#",
            "#....##...",
            "..#..#....",
            "##.#..#..#",
            "#....#...#",
            "...#.#...#",
            "....######",
    };
    tiles[2837] = {
            "##..#...##",
            "#....##..#",
            "...#....##",
            ".#...#....",
            "#.....#...",
            "#.#...##.#",
            "##..###..#",
            "#........#",
            "#.........",
            "..###..#..",
    };
    tiles[1423] = {
            "####.#...#",
            "#.#......#",
            "...#.....#",
            "#####.#...",
            "#..#..##..",
            ".....##...",
            "##.##.....",
            "#.#....#.#",
            "...#.....#",
            "#.#.#..#..",
    };
    tiles[3943] = {
            "#.....#..#",
            "...##..#..",
            "...#......",
            ".#.#......",
            "#...#.....",
            "#.#.#..#..",
            "........##",
            ".........#",
            "##..##.#.#",
            "..#.#.##..",
    };
    tiles[3779] = {
            "..#.#..#.#",
            "...##...##",
            ".......#.#",
            "..#.....#.",
            "..##......",
            "#.#....###",
            ".#.#.....#",
            "#.........",
            "##...#...#",
            "#.#.##.###",
    };
    tiles[1583] = {
            "##..#.##.#",
            "..#.....#.",
            "#..#...##.",
            "#..#.#.#.#",
            ".......#.#",
            "#.##..###.",
            "#######.#.",
            "..#.....##",
            "#.##....##",
            "#..##.#.##",
    };
    tiles[3041] = {
            "...#.###..",
            "#......#..",
            "..#....#..",
            ".##.....##",
            "#.#...##.#",
            "......#.#.",
            "..........",
            ".#...#.#..",
            "..#..#...#",
            "#.##.##.#.",
    };
    tiles[1889] = {
            "...#.##.#.",
            ".#..#.....",
            "#..#.....#",
            "........#.",
            ".........#",
            "..#...#..#",
            "###....###",
            "#.#.......",
            "#..#.....#",
            "...##..#..",
    };
    tiles[1493] = {
            "....##..#.",
            "#........#",
            "#..#......",
            ".....#..#.",
            "#.........",
            "...#.....#",
            ".........#",
            ".#.#.....#",
            "..........",
            "...#######",
    };
    tiles[1987] = {
            "#..#####..",
            "#........#",
            "###..##..#",
            ".#....#...",
            "......#...",
            "#...##..##",
            "........#.",
            ".##.....#.",
            "##...###..",
            "##..##.#..",
    };
    tiles[2003] = {
            "..#.#.####",
            "##..######",
            "#.#..#.#.#",
            "...#.....#",
            "#.........",
            "......#..#",
            ".......#.#",
            "##........",
            "##....#..#",
            "..#..#.##.",
    };
    tiles[1297] = {
            ".....###..",
            "...#...#.#",
            "...#.#...#",
            "..........",
            ".....#...#",
            "#.......#.",
            "..#.......",
            "..#.......",
            "....#....#",
            "#.#######.",
    };
    tiles[3049] = {
            "#..###..#.",
            "..###...##",
            "##........",
            "#........#",
            ".....#.#..",
            "##..##..#.",
            "#..#.#....",
            "#.....#...",
            "###.#.....",
            "#..#....##",
    };
    tiles[2143] = {
            "#...#.#.#.",
            "#......#.#",
            "#.#..#####",
            "###..#.#..",
            "#.##...###",
            "....#.#.#.",
            "#........#",
            "..........",
            "#...#...#.",
            ".##.##..##",
    };
    tiles[1753] = {
            "#.#.#..##.",
            "....#.....",
            "#...###...",
            "#.....#.#.",
            "#.#..###..",
            "......#...",
            "...#.....#",
            "..#....#.#",
            "#...##....",
            "..#.#..##.",
    };
    tiles[3407] = {
            "..###.##..",
            "....#.#..#",
            ".#...#....",
            "....##....",
            "#..##....#",
            "....#.....",
            ".....#....",
            ".#.......#",
            "#.....#..#",
            ".##...#.##",
    };
    tiles[1783] = {
            ".#..####..",
            "##........",
            "...###..##",
            "#......#.#",
            "#.........",
            "..........",
            "##........",
            "........#.",
            "##.####.##",
            ".####.#.#.",
    };
    tiles[3593] = {
            "#.#.....##",
            "......#..#",
            "##...#.#.#",
            "#.#.#...#.",
            "..........",
            ".....###..",
            "#...#.#...",
            "###...##..",
            "#.#...#...",
            "..#.....##",
    };
    tiles[1249] = {
            "###....##.",
            "##..#..#.#",
            ".#.#.##..#",
            "..#.......",
            ".........#",
            "#....#.#.#",
            "..##..#..#",
            "###.####.#",
            ".#.#.....#",
            "....##...#",
    };
    tiles[2963] = {
            "..##.#..#.",
            "#..##....#",
            "#.#..#..##",
            ".#...####.",
            "..#......#",
            "##...##.#.",
            ".........#",
            "#....#...#",
            "##.....#.#",
            "####.#....",
    };
    tiles[1289] = {
            ".#....#...",
            ".##.#.....",
            ".##.#.....",
            "#.........",
            "....#...##",
            "##.......#",
            "...#.....#",
            "..........",
            "..........",
            ".#.##.#...",
    };
    tiles[2053] = {
            "#.#.#...#.",
            "....#.##.#",
            ".........#",
            "#.....#..#",
            "....#.....",
            ".##......#",
            "#...#.#...",
            "#...#.#...",
            "...#..#...",
            "#..#.#.###",
    };
    tiles[3001] = {
            ".#...#...#",
            "....##..#.",
            "....##...#",
            "...###...#",
            "#..#....##",
            "#.......#.",
            "#.##.....#",
            "....#.#.##",
            ".#..##.#..",
            ".##.....##",
    };
    tiles[2591] = {
            ".####.##..",
            "......#.##",
            "..#......#",
            "....#....#",
            "..#....###",
            "..##......",
            "#........#",
            ".......#.#",
            "#....#....",
            "##.###...#",
    };
    tiles[1931] = {
            ".##..#.#..",
            "#.........",
            "..#......#",
            ".#.......#",
            "....#.....",
            "..#.......",
            "##...##...",
            "#...###..#",
            "#.#.....#.",
            "#.#..#...#",
    };
    tiles[3203] = {
            ".###.....#",
            "...#..#..#",
            "##........",
            ".........#",
            "#.#....#..",
            ".#........",
            "#.......##",
            "#....####.",
            "#.........",
            "##....#...",
    };
    tiles[1747] = {
            "#...##..##",
            "...#.#...#",
            "#.#......#",
            "#....#..##",
            ".##.......",
            "##..#.##..",
            "##....#..#",
            "#...#.....",
            "#.#....#..",
            ".##.#.#.##",
    };
    tiles[3557] = {
            "#.##..#...",
            "#.......##",
            ".#.#.#....",
            "#...#.#...",
            "#.#.##....",
            "#...#....#",
            "..........",
            "#....#....",
            "#...#.....",
            "####..###.",
    };
    tiles[3329] = {
            "#..##.....",
            "..........",
            "..#.......",
            ".....##.##",
            "....#.....",
            ".##....#..",
            ".....#....",
            "..........",
            "#####.#..#",
            "#..#.##...",
    };
    tiles[3067] = {
            "#..##....#",
            ".#.#..#..#",
            "..#......#",
            "#...#....#",
            "#.....#...",
            "..#.#....#",
            "#.#...#..#",
            ".....#....",
            "..#......#",
            ".#.##.....",
    };
    tiles[3371] = {
            "#.###..#..",
            "#.#....#..",
            "#....#...#",
            "#.....#..#",
            "..#..##..#",
            "#.#.....#.",
            ".#.#..####",
            "#.#..#....",
            "..#..#....",
            "##......#.",
    };
    tiles[3467] = {
            "#.#....#..",
            "##....##.#",
            "...#..####",
            "...#.#...#",
            ".........#",
            "..#.......",
            "...#...#.#",
            "...#......",
            ".####....#",
            "..#.....#.",
    };
    tiles[3923] = {
            "...#...##.",
            "#........#",
            ".#........",
            "#.......##",
            "#.#.#.....",
            ".........#",
            "....#.....",
            "#.........",
            "...#.#..##",
            "#.######..",
    };
    tiles[1453] = {
            "#.#...##..",
            "##....#..#",
            "#......#..",
            "..........",
            "#.#.##...#",
            "#........#",
            ".....#....",
            ".##....#..",
            "..........",
            "#.###.###.",
    };
    tiles[3331] = {
            ".##.#..#.#",
            ".......#.#",
            "#......#..",
            "..#......#",
            "#..#.....#",
            "#..#.....#",
            "#.#.....##",
            "#.........",
            "..........",
            "####.#...#",
    };
    tiles[2633] = {
            "..#.#....#",
            "###......#",
            ".......#.#",
            "....#....#",
            "###.#...#.",
            ".#....#..#",
            "##.....#.#",
            ".##..#....",
            "#...#...#.",
            "..#...##..",
    };
    tiles[1811] = {
            "#..#######",
            ".##.....#.",
            "#.....##.#",
            "#..#...#..",
            "#...#.....",
            "##..#..#..",
            "#.##.#..#.",
            ".#........",
            "##...#.#.#",
            ".####.#..#",
    };
    tiles[1777] = {
            ".####...#.",
            ".#....#.#.",
            "###..#....",
            "..#..#...#",
            "#.#.#.##..",
            "#...#..###",
            "#....#...#",
            "......#...",
            ".....#...#",
            "####.#..##",
    };
    tiles[1697] = {
            "#.##..#..#",
            "#........#",
            "##.####...",
            "##......#.",
            "#.##....#.",
            "##..#..#..",
            "#..#..#..#",
            "#.....####",
            "...#.#....",
            "##.###.#.#",
    };
    tiles[2551] = {
            "#..###..##",
            "..#...#...",
            "..........",
            ".#..#.....",
            "##.....#..",
            "...#.#.#..",
            "..#..##..#",
            ".##.......",
            ".###......",
            "...###.##.",
    };
    tiles[2351] = {
            "#...#####.",
            "......##.#",
            "....##...#",
            ".........#",
            "#.........",
            "#.....#..#",
            "#........#",
            "..##.....#",
            "....#..#..",
            ".#.#....##",
    };
    tiles[2689] = {
            "..###..###",
            ".........#",
            "#...#.....",
            "##..#..#..",
            "#.#.###...",
            "....#....#",
            "#........#",
            "......#.#.",
            "#.#..####.",
            "####.###.#",
    };
    tiles[3253] = {
            "..##......",
            "..#.#....#",
            "..#.#...#.",
            "#...#.....",
            "#..#.#....",
            ".#....#...",
            "....#.....",
            "#.........",
            "#......#..",
            "#..#.#####",
    };
    tiles[2843] = {
            "####..#...",
            "#.....##.#",
            "##....#...",
            ".##..#.#..",
            "..###.#...",
            "...#...###",
            "#..#..#...",
            ".....#..##",
            "#....#..##",
            "...#..#.#.",
    };
    tiles[1187] = {
            ".##.####.#",
            "......#..#",
            "...#.....#",
            ".....#...#",
            ".......#.#",
            ".........#",
            "#..#......",
            "..#......#",
            "#...#....#",
            "#####...##",
    };
    tiles[3529] = {
            ".....#####",
            ".#...#....",
            "#..#.#....",
            "#........#",
            ".#....#.##",
            "##..##.#..",
            "..##.#..##",
            ".#........",
            "......#..#",
            "###..#.##.",
    };
    tiles[1489] = {
            ".##.#.####",
            "#.#..#.#..",
            "#....#....",
            "#.#..#....",
            ".#...#....",
            "..........",
            "#.#..##..#",
            ".........#",
            ".......#..",
            ".....###.#",
    };
    tiles[1097] = {
            "###.###.#.",
            ".#...#....",
            ".......#..",
            ".#....#.#.",
            ".....#...#",
            "#.#.....##",
            "####..##.#",
            "###......#",
            "#........#",
            "##..#.#.##",
    };
    tiles[3491] = {
            "#...#.##..",
            "...##....#",
            "..#.....#.",
            "#.#.#....#",
            "#..#.#...#",
            ".....#...#",
            "....#.....",
            "....#.#..#",
            "........##",
            "##....#...",
    };
    tiles[3947] = {
            "######.#.#",
            "#.#.#....#",
            "...#.#..#.",
            "...#.#....",
            "#...#...##",
            "....#.....",
            ".......#..",
            "##..#....#",
            "..#..#....",
            ".###..####",
    };
    tiles[3313] = {
            ".#....#.##",
            ".##.......",
            "#.##......",
            "##........",
            "#.#.......",
            "...#.....#",
            "...#......",
            "......#..#",
            "##......#.",
            "####.#..#.",
    };
    tiles[1277] = {
            "#..###..#.",
            "#....#...#",
            ".##....###",
            "#........#",
            "#....##...",
            "#.#...#..#",
            "#...#....#",
            "...#...#..",
            "...##....#",
            ".#...#.#.#",
    };
    tiles[3121] = {
            ".#...#..##",
            "........#.",
            "..#..#####",
            "#.....#.##",
            "..#.....##",
            "..........",
            "#.........",
            "#..###...#",
            ".........#",
            "###.#.#.#.",
    };
    tiles[2287] = {
            "#....#.#.#",
            "#.#..#....",
            "#.....#...",
            "..........",
            "##.#......",
            "##..#..###",
            "..##....##",
            ".....#....",
            "#........#",
            "..#.#...#.",
    };
    tiles[1171] = {
            "#..#.#...#",
            "..#...#...",
            "##.......#",
            "####...#.#",
            "#.#.#.#...",
            ".#.......#",
            "##....####",
            "#...##..#.",
            "........#.",
            "##.###.##.",
    };
    tiles[2503] = {
            "#...#.#..#",
            "..#..##.##",
            "...#...###",
            ".##.#...##",
            "#.........",
            "#........#",
            "##.......#",
            "....#.#...",
            "...#.....#",
            "..#...#.##",
    };
    tiles[2579] = {
            "#.#..#..##",
            ".........#",
            "####......",
            "..#....#..",
            "#.#..##..#",
            "#.....##.#",
            "....#....#",
            ".........#",
            "..#..#..##",
            "#..##.####",
    };
    tiles[1867] = {
            ".##.....#.",
            ".........#",
            ".#....#.#.",
            "#....#..##",
            "##........",
            "...#......",
            "#....##..#",
            "##..##.#.#",
            "#.........",
            "####..##.#",
    };
    tiles[2081] = {
            ".##..#...#",
            "......###.",
            "..##.#..##",
            "##..##....",
            "#..#.#...#",
            "....#...#.",
            "##.....#.#",
            "..#....#..",
            "#...#...##",
            ".####..#.#",
    };
    tiles[3319] = {
            "..#...#.#.",
            ".....#....",
            ".#........",
            "#.......#.",
            "#.........",
            ".....#...#",
            "#.....###.",
            "#........#",
            "........##",
            "#...#####.",
    };
    tiles[3727] = {
            "##.#.#...#",
            "#.........",
            "..##.....#",
            "#...#.#...",
            "#.#.#...#.",
            ".###.#....",
            "......#.##",
            "#...#....#",
            "...#.#...#",
            "#..#.#..##",
    };
    tiles[1103] = {
            "###.##.#..",
            ".#..#.##..",
            ".#..###.#.",
            "#.#..##.#.",
            ".##...##.#",
            "....#....#",
            "....#..#.#",
            "...#...###",
            "...#..#.#.",
            "###.#..##.",
    };
    tiles[3463] = {
            "##...#.#.#",
            "....#..##.",
            "........##",
            ".#.......#",
            "..#..#....",
            "#.#....#..",
            "##....#..#",
            "...#..#..#",
            "#.#......#",
            "#.###..##.",
    };
    tiles[3449] = {
            "..###.##..",
            "..#..#....",
            "#...##....",
            ".####..###",
            ".#..###.##",
            "#.#....##.",
            "......#..#",
            "..........",
            "##........",
            "#.......#.",
    };
    tiles[2207] = {
            "#...#.#.#.",
            ".##.....#.",
            "#####....#",
            "..#.#.....",
            "#..#....##",
            ".#....##.#",
            "#....#.#.#",
            "...#....#.",
            "..#.#.....",
            "##..#.##.#",
    };
    tiles[2647] = {
            ".#####..#.",
            ".#..#....#",
            "....#.#..#",
            ".##.......",
            "...#..###.",
            "####...###",
            "##.....#.#",
            "#..#.....#",
            "#.#.....##",
            "..##.##..#",
    };
    tiles[2539] = {
            "##..#..###",
            "...#..#..#",
            ".#....#...",
            "###....#..",
            ".#...#....",
            "...##.....",
            "..#..##.#.",
            "...#......",
            "#...#....#",
            "#.#.##....",
    };
    tiles[2927] = {
            ".#.....##.",
            "#.......#.",
            "#..##..##.",
            "#...#.....",
            "....#...##",
            ".#.#.#..##",
            "........##",
            "###.#...#.",
            "...#.....#",
            ".##.....##",
    };
    tiles[2153] = {
            "#.#..##..#",
            "...#.####.",
            "#..##.....",
            ".........#",
            "#.....#..#",
            "...##.....",
            "...#...###",
            "..##..####",
            "...#...###",
            "##.#.##.##",
    };
    tiles[3083] = {
            "###.#..#.#",
            "...#.....#",
            "#.......##",
            "..#......#",
            "...#.....#",
            "..........",
            "..#......#",
            ".##....#..",
            "#......###",
            "..#......#",
    };
    tiles[1237] = {
            ".#....###.",
            "#.........",
            "#...#...##",
            ".....#.#..",
            "#.........",
            "....#..#..",
            "........##",
            "##......#.",
            "#.........",
            "#..##.#...",
    };
    tiles[2239] = {
            "#.....##.#",
            "##........",
            "....##....",
            "#.##....##",
            "###.#..###",
            "#........#",
            ".........#",
            "#..#.#.#..",
            ".........#",
            ".#..#.....",
    };
    tiles[1093] = {
            ".####..#..",
            "##....#...",
            "..#.#...##",
            "...#..#...",
            "#........#",
            "#...#.#..#",
            "#.#####..#",
            "....#.#...",
            "#.#.#..#.#",
            "#.#..#####",
    };
    tiles[2221] = {
            "......#.#.",
            "....#..#.#",
            "#..#...#.#",
            ".#........",
            "#........#",
            "##....##.#",
            "##.....#.#",
            "##...#...#",
            "#..#..#...",
            "..##....#.",
    };
    tiles[1523] = {
            "##.###.###",
            "###..#..#.",
            "#..##...##",
            "#..#.#....",
            "#..#.....#",
            "#.#......#",
            "#.......#.",
            "#.........",
            ".#.###.##.",
            "...#.#...#",
    };
    tiles[3673] = {
            "###.##..#.",
            "..........",
            ".#.......#",
            "#..#.##...",
            "......#..#",
            "#.....##..",
            "##....#..#",
            "..#...#...",
            "#...#...#.",
            "#####...##",
    };
    tiles[2063] = {
            "####.....#",
            "#........#",
            "......#..#",
            "#.#..#....",
            "#.#.....#.",
            "...#.....#",
            "#...##..#.",
            "#.....#...",
            "......#.##",
            "..##.#.##.",
    };
    tiles[3631] = {
            "#.#.#.####",
            "...#.#....",
            "...#.#...#",
            "#....#.#..",
            "#..#...###",
            "#.##......",
            "#..#...###",
            "#.#.#..#..",
            ".......##.",
            ".#.#......",
    };
    tiles[2693] = {
            "###.####.#",
            "...#......",
            "....#.#..#",
            "#.#..#....",
            ".....###.#",
            "#....#....",
            "##.###....",
            "#.....#..#",
            "#.....#...",
            "######.#.#",
    };
    tiles[2593] = {
            "###.....##",
            ".....#....",
            "..#...#...",
            ".....#...#",
            "..##......",
            "###.......",
            ".##......#",
            "#....#...#",
            "#..#..#..#",
            "#.###.#.#.",
    };
    tiles[3607] = {
            ".##.##.#..",
            "#...#..##.",
            "....#..#..",
            "#......#.#",
            "..........",
            "..........",
            ".......#..",
            "#....##..#",
            ".......#.#",
            ".#####....",
    };
    tiles[1223] = {
            ".####..#.#",
            "......##..",
            ".........#",
            "...#....#.",
            "#....#.#..",
            "##.#...#..",
            ".#......##",
            ".........#",
            "#.#.#....#",
            "##.#..#..#",
    };
    tiles[3433] = {
            "##.###..##",
            "#..#.##...",
            "##....#..#",
            "#.........",
            "###.##.#.#",
            "....##....",
            "#...#.#..#",
            "...#......",
            "##....#..#",
            "##.#.#...#",
    };
    tiles[1217] = {
            "#..###.###",
            "#.#...#...",
            "..#.##....",
            "#.......#.",
            "#.......#.",
            "##...#..##",
            "#..#..#...",
            "#..####..#",
            "#...##...#",
            ".####.###.",
    };
    tiles[2861] = {
            "#..##.#.#.",
            "#...#.##..",
            ".#...####.",
            ".......#.#",
            "..#...#..#",
            "#...##...#",
            "#.....#.#.",
            "......##.#",
            "##..#.##..",
            "###..####.",
    };
    tiles[1327] = {
            "....#.####",
            "...####...",
            "....#.#...",
            "..#...#.#.",
            "....#....#",
            "..#..#...#",
            "....##....",
            "......#...",
            "#....##.##",
            "##.######.",
    };
    tiles[3613] = {
            "#.##.###..",
            "#..#..#..#",
            "..##.##...",
            "..#..#####",
            "...###..##",
            "#...#.#.##",
            "#....#....",
            "...#.....#",
            ".###.#..##",
            "####...###",
    };
    tiles[2909] = {
            "#####..#..",
            "#...#..#..",
            "#.#....#..",
            "..#.......",
            "...##...#.",
            ".#.##..###",
            "...#.....#",
            ".........#",
            "...#.##..#",
            "#######.##",
    };
    tiles[1709] = {
            "#.#.##....",
            "#......#.#",
            ".#........",
            "#......#..",
            ".........#",
            "......#.#.",
            "..##......",
            ".....#....",
            "..#.##....",
            "#....#####",
    };
    tiles[2857] = {
            "###.#...##",
            "#.#....#..",
            "........##",
            "#.#...#..#",
            "#......#..",
            ".....####.",
            "......#..#",
            "..........",
            "#.#.....##",
            "..#..##...",
    };
    tiles[3541] = {
            "#.#.##.###",
            ".....##..#",
            "..#.#.....",
            "#..#.....#",
            "##....#...",
            "#.#...#...",
            "....##....",
            ".........#",
            ".##....#.#",
            "...#.....#",
    };
    tiles[2459] = {
            "##..#.#..#",
            "...#.#.##.",
            "##...#....",
            ".##.#.#...",
            "#.....#..#",
            "...#.....#",
            "......#...",
            ".....##...",
            "...##...#.",
            "..#..###..",
    };
    tiles[1621] = {
            "#.##.###..",
            "##..#.#...",
            ".#.##...##",
            ".###.#..##",
            ".#..##.#..",
            "#.......##",
            ".....##...",
            "..#.......",
            "#.........",
            "#..#..###.",
    };
    tiles[3833] = {
            "#..#...###",
            ".........#",
            "#.....#...",
            "#..#...#.#",
            "#......#..",
            ".#........",
            "..#.......",
            ".........#",
            "......##.#",
            ".#..#.#.##",
    };
    tiles[1117] = {
            "..##.....#",
            "..##......",
            "#..#.#...#",
            "#...##..##",
            "....#...#.",
            "#...#....#",
            "....#..#.#",
            "...#.....#",
            "#..#.....#",
            "..#.##..##",
    };
    tiles[3413] = {
            "#.#..#.###",
            "....##.#.#",
            "...#.....#",
            ".........#",
            "#.........",
            ".....##.##",
            "..#....#..",
            "#.....##..",
            "#........#",
            "#.######..",
    };
    tiles[2141] = {
            ".##.#..#.#",
            "#.###.....",
            "#..#....#.",
            "#..#....#.",
            "..#.......",
            ".#.....#.#",
            "##......#.",
            "..#..#.###",
            "...#.....#",
            "...#..#..#",
    };
    tiles[3547] = {
            "####.#..##",
            "...#.#...#",
            "......#...",
            "##.#......",
            "#........#",
            ".##...#..#",
            ".#...#..##",
            "#..#..#...",
            "#.##......",
            "##.###..#.",
    };
    tiles[1069] = {
            "##.#..##.#",
            ".#....#..#",
            ".##......#",
            ".#....#.##",
            "#..#..#...",
            "..#.#.....",
            "..........",
            "#....#..#.",
            "##........",
            "..#...##.#",
    };
    tiles[3169] = {
            "##.##.#..#",
            "#.....####",
            ".##...##..",
            "#....#.#.#",
            "#.#..##...",
            "#........#",
            ".#.......#",
            ".#........",
            ".........#",
            "#..#...#.#",
    };
    tiles[1307] = {
            "..##..#.##",
            "###.#...##",
            "..##.....#",
            "#.##.....#",
            ".....#.#..",
            "..#....#..",
            "....#...#.",
            ".....#..##",
            ".#.....#.#",
            "##.#.....#",
    };
    tiles[3359] = {
            "#.#.#..#..",
            "........#.",
            ".#...#...#",
            "#....##..#",
            ".#.#......",
            "#...#.#.#.",
            ".#...###.#",
            "#........#",
            ".#.#.....#",
            "###.#..#..",
    };
    tiles[2713] = {
            "#...#...##",
            "##.###.#..",
            "..##....#.",
            "...#.....#",
            "..#.....#.",
            "#....#...#",
            "....#.....",
            "#..##....#",
            ".........#",
            "#######..#",
    };
    tiles[2897] = {
            "...####..#",
            "...#...#.#",
            "#.......#.",
            "......#...",
            ".....#...#",
            ".........#",
            ".#.#......",
            "######..##",
            "...#..#..#",
            "#..###.###",
    };
    tiles[3929] = {
            "....#.#.#.",
            ".#...#....",
            "#.##..###.",
            "..##......",
            "#.##...#..",
            "#...#.....",
            ".......###",
            "#.##.....#",
            "#...#.....",
            "...#######",
    };
    tiles[1031] = {
            "#####.#.#.",
            "#....##.#.",
            "#..#..#..#",
            ".........#",
            "##.#...#.#",
            "....#...#.",
            ".......#..",
            "#......#..",
            "......#..#",
            ".#.....#.#",
    };
    tiles[1361] = {
            "#.#.#.....",
            ".#........",
            "..##...#.#",
            "#..##.#..#",
            ".....#####",
            ".......##.",
            "#........#",
            "..........",
            "#..#...#.#",
            "##.###.#.#",
    };
    tiles[3853] = {
            "#..##.....",
            ".........#",
            "#..#......",
            "#.........",
            "###.....#.",
            "...#.#...#",
            "#.........",
            "..........",
            "..........",
            "##.##.####",
    };
    tiles[1009] = {
            "...#.#...#",
            "..##....#.",
            ".......#..",
            ".....#...#",
            "#..#...#.#",
            ".#..#..#..",
            "..##.#..#.",
            "....#.#..#",
            "#..#.#....",
            "###.#.####",
    };
    tiles[3761] = {
            ".##.#.#.#.",
            "..#......#",
            "#....##...",
            ".#........",
            "#...#..#.#",
            ".........#",
            "#.........",
            ".........#",
            ".#.......#",
            "#..#......",
    };
    tiles[2521] = {
            ".#.....###",
            "#........#",
            "...##....#",
            "###.......",
            "#....#....",
            "###..#...#",
            "##....#..#",
            ".#........",
            ".........#",
            "#..#...###",
    };
    tiles[1907] = {
            ".####.#..#",
            "...#..#..#",
            "#.#..##.##",
            "##....##.#",
            "#........#",
            "#...#.....",
            "#.........",
            "#.#..#...#",
            "##....###.",
            ".##.###.#.",
    };
    tiles[2039] = {
            "...##..###",
            "###...#...",
            ".#.......#",
            "...##.#...",
            ".........#",
            "......#..#",
            "#........#",
            "###....#.#",
            "#.#......#",
            "#..#...#..",
    };
    tiles[2389] = {
            "##.##.###.",
            "#.#.......",
            "........##",
            ".........#",
            "...#......",
            "..........",
            "#...#..#.#",
            "#.......#.",
            "....#..###",
            "####.###.#",
    };
    tiles[2089] = {
            "#.#..#.#.#",
            "#........#",
            ".#.....#..",
            "..........",
            "#....#...#",
            "#........#",
            "#.........",
            "#.........",
            "#...#.....",
            "#.#...#..#",
    };
    tiles[2137] = {
            ".#####..##",
            "..#......#",
            "#.#..#....",
            ".#......#.",
            "#...#.....",
            "......#...",
            "....##..#.",
            ".##....#.#",
            "#..#..#..#",
            "#..####.##",
    };
    tiles[3191] = {
            "..###....#",
            ".........#",
            "........##",
            "....#..#..",
            ".........#",
            "#.........",
            "..#..#..#.",
            ".#....###.",
            "#.....#..#",
            "#..#####.#",
    };
    tiles[2789] = {
            "#.#.#.##.#",
            "...#.....#",
            "#..###...#",
            "#........#",
            "##.......#",
            "#..##....#",
            ".#........",
            ".........#",
            "..#......#",
            "......#..#",
    };
    tiles[1567] = {
            "....#....#",
            "#..##..##.",
            ".....#....",
            "#.##.##...",
            "....##....",
            "##...#...#",
            "#.#.#....#",
            "......###.",
            "..#.#..#.#",
            ".#..##.#.#",
    };
    tiles[1163] = {
            ".###..##..",
            ".#.....#.#",
            "#...###..#",
            ".....#....",
            ".........#",
            "..#...#..#",
            "..#..##.##",
            ".##..###.#",
            ".........#",
            "##.##..#.#",
    };
}

std::vector<Grid> result;


size_t hashes(const std::vector<std::string>& pic) {
    size_t sum = 0;
    for (auto& line: pic) {
        sum += std::count(line.begin(), line.end(), '#');
    }
    return sum;
}

void build_grid(const Grid& grid, size_t next_element) {
    if (next_element == 144) {
        size_t mult = grid.data[0][0].nr * grid.data[0][11].nr * grid.data[11][11].nr * grid.data[11][0].nr;
        std::cout << "PART1 " << mult << " alternative " <<  grid.data[0][0].alternative << grid.data[0][11].alternative << grid.data[11][11].alternative << grid.data[11][0].alternative << std::endl;


        auto merged_pic = merge(grid);

        size_t total_hashes = hashes(merged_pic);
        std::vector<size_t> nr_monster;
        for (int i = 0; i < num_alternatives; i++) {
            auto rotate_merged_pic = rotate_pic(merged_pic, i);
            nr_monster.push_back(search_monsters(rotate_merged_pic));
        }
        std::sort(nr_monster.begin(), nr_monster.end(), [](auto a, auto b) { return a > b; });

        for (auto nr : nr_monster) {
            std::cout << nr << "(" << total_hashes - hashes(monster) * nr << ") ";
        }
        std::cout <<  std::endl;

        result.push_back(grid);
        return;
    }
    for (size_t remaining_nr : grid.remaining_tiles_nr) {
        for (size_t orientation = 0; orientation < num_alternatives; orientation++) {
            if (add(grid, remaining_nr, next_element, orientation)) {
                Grid new_grid = grid;

                auto it = std::find(new_grid.remaining_tiles_nr.begin(), new_grid.remaining_tiles_nr.end(), remaining_nr);
                assert(it != new_grid.remaining_tiles_nr.end());
                new_grid.remaining_tiles_nr.erase(it);

                auto x = get_x(next_element);
                auto y = get_y(next_element);
                auto& tile_in_grid = new_grid.data.at(y).at(x);


                tile_in_grid.tile = &tiles.at(remaining_nr);
                tile_in_grid.alternative = orientation;
                tile_in_grid.nr = remaining_nr;

                build_grid(new_grid, next_element + 1);
            }
        }
    }
}

int _20() {
    fill_tiles();

    Grid grid;
    std::vector<TileWithNumber> empty_row(12);
    grid.data = std::vector<std::vector<TileWithNumber>>(12, empty_row);

    for (auto& [key, value] : tiles) {
        grid.remaining_tiles_nr.push_back(key);
    }
    build_grid(grid, 0);

    std::vector<std::string> example_with_2_monsters{
            ".####...#####..#...###..",
            "#####..#..#.#.####..#.#.",
            ".#.#...#.###...#.##.##..",
            "#.#.##.###.#.##.##.#####",
            "..##.###.####..#.####.##",
            "...#.#..##.##...#..#..##",
            "#.##.#..#.#..#..##.#.#..",
            ".###.##.....#...###.#...",
            "#.####.#.#....##.#..#.#.",
            "##...#..#....#..#...####",
            "..#.##...###..#.#####..#",
            "....#.##.#.#####....#...",
            "..##.##.###.....#.##..#.",
            "#...#...###..####....##.",
            ".#.##...#.##.#.#.###...#",
            "#.###.#..####...##..#...",
            "#.###...#.##...#.######.",
            ".###.###.#######..#####.",
            "..##.#..#..#.#######.###",
            "#.#..##.########..#..##.",
            "#.#####..#.#...##..#....",
            "#....##..#.#########..##",
            "#...#.....#..##...###.##",
            "#..###....##.#...##.##.#"
    };

    std::cout << search_monsters(example_with_2_monsters) << std::endl;
    std::cout << hashes(example_with_2_monsters) - hashes(monster)*search_monsters(example_with_2_monsters) << std::endl;

    std::cout << tiles.size() << std::endl;

    return 0;
}
